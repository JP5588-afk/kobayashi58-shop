<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã“ã°ã‚„ã—é¸ç‰©æ‰€</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .cart-float {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      z-index: 999;
    }

    .cart-float span {
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 14px;
      margin-left: 4px;
      vertical-align: top;
    }

    .fly-img {
      position: absolute;
      z-index: 9999;
      width: 50px;
      transition: all 0.7s ease-in-out;
      pointer-events: none;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 12px;
    }

    .button-group a {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 46px;
      padding: 0 16px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 12px;
      text-decoration: none;
      color: white;
      box-sizing: border-box;
      flex: 1;
      max-width: 160px;
    }

    .button-group .cart-btn {
      background-color: #ff69b4;
    }

    .button-group .line-btn {
      background-color: #00c300;
    }

    .button-group .line-btn:hover {
      background-color: #059944;
    }

    /* æ•¸é‡é¸å–®æ¨£å¼ */
    .qty-select {
      margin-top: 8px;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ff69b4;
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

  <!-- å³ä¸Šè§’æµ®å‹•è³¼ç‰©è»Šåœ–ç¤º -->
  <a href="cart.html" class="cart-float" id="cart-float">ğŸ›’<span id="cart-count">0</span></a>

  <header>
    <h1>ã“ã°ã‚„ã—é¸ç‰©æ‰€</h1>
    <p class="tagline">ç²¾é¸æ—¥ç³»é›¶é£Ÿèˆ‡å°ç‰©ï¼Œæ¯ä¸€æ¨£éƒ½æƒ³æŠ±å›å®¶ ğŸ¡</p>
    <div class="button-group">
      <a href="notice.html" class="cart-btn">ğŸ“Œ è¨‚è³¼é ˆçŸ¥</a>
      <a href="https://line.me/ti/g/C9W7CPNKNQ" class="line-btn" target="_blank">ğŸ’¬ LINEç¾¤çµ„</a>
    </div>
  </header>

  <main class="product-grid">
    <div class="product">
      <a href="product.html?name=Pocky%20å·§å…‹åŠ›æ£’">
        <img src="https://i.imgur.com/xkU43cF.png" alt="Pocky">
      </a>
      <a href="product.html?name=Pocky%20å·§å…‹åŠ›æ£’">
        <h2>Pocky å·§å…‹åŠ›æ£’</h2>
      </a>
      <p>NT$59</p>
      <select class="qty-select">
        ${[...Array(10).keys()].map(i => `<option value="${i + 1}">${i + 1}</option>`).join('')}
      </select>
      <button onclick="addToCart(this)">åŠ å…¥è³¼ç‰©è»Š</button>
    </div>

    <div class="product">
      <a href="product.html?name=Calbee%20è–¯æ¢">
        <img src="https://i.imgur.com/yYB2rVA.png" alt="Calbee">
      </a>
      <a href="product.html?name=Calbee%20è–¯æ¢">
        <h2>Calbee è–¯æ¢</h2>
      </a>
      <p>NT$89</p>
      <select class="qty-select">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
      <button onclick="addToCart(this)">åŠ å…¥è³¼ç‰©è»Š</button>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", updateCartIconCount);

    function addToCart(button) {
      const product = button.closest('.product');
      const name = product.querySelector('h2').innerText;
      const price = parseInt(product.querySelector('p').innerText.replace('NT$', ''));
      const img = product.querySelector('img').src;
      const qty = parseInt(product.querySelector('.qty-select').value); // âœ… é¸æ“‡çš„æ•¸é‡

      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existingItem = cart.find(item => item.name === name);
      if (existingItem) {
        existingItem.quantity += qty;
      } else {
        cart.push({ name, price, quantity: qty, img });
      }
      localStorage.setItem("cart", JSON.stringify(cart));

      // é£›è¡Œå‹•ç•«
      const flyingImg = product.querySelector('img').cloneNode();
      const imgRect = product.querySelector('img').getBoundingClientRect();
      const cartIcon = document.getElementById('cart-float');
      const cartRect = cartIcon.getBoundingClientRect();

      flyingImg.classList.add('fly-img');
      flyingImg.style.top = imgRect.top + 'px';
      flyingImg.style.left = imgRect.left + 'px';
      flyingImg.style.width = imgRect.width + 'px';

      document.body.appendChild(flyingImg);

      setTimeout(() => {
        flyingImg.style.top = cartRect.top + 'px';
        flyingImg.style.left = cartRect.left + 'px';
        flyingImg.style.width = '0px';
        flyingImg.style.opacity = '0';
      }, 10);

      setTimeout(() => {
        flyingImg.remove();
        updateCartIconCount();
      }, 700);
    }

    function updateCartIconCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cart-count').textContent = totalQty;
    }
  </script>
</body>
</html>
